MUSIC_TYPE ={
-- 音乐
   MUSIC_BACK_CITY = "1001_citymusic.mp3",           -- 主城背景音乐
   MUSIC_BACK_MAP =  "1002_mapmusic.mp3",            -- 大地图背景

-- 音效
   MUSIC_EFFECT_N_EUROPE = "2001.mp3",               -- 北欧入场
   MUSIC_EFFECT_W_EUROPE = "4005.mp3",               -- 西欧入场
   MUSIC_EFFECT_ARAB = "2003.mp3",                   -- 阿拉伯入场
   MUSIC_EFFECT_ASIAN = "2004.mp3",                  -- 亚洲入场
   MUSIC_EFFECT_AMERICA = "2005.mp3",                -- 美洲入场

   MUSIC_EFFECT_BUTTON = "2000.mp3",                 -- 按钮音效

   MUSIC_EFFECT_CITY_CENTER = "2006.mp3",            -- 城镇中心
   MUSIC_EFFECT_CITY_HOUSE = "2007.mp3",             -- 房屋
   MUSIC_EFFECT_CITY_DOOR = "2008.mp3",              -- 城门
   MUSIC_EFFECT_CITY_TOWER = "2009.mp3",             -- 瞭望塔
   MUSIC_EFFECT_CITY_BARRACK = "2010.mp3",           -- 军营
   MUSIC_EFFECT_CITY_RANGE = "2011.mp3",             -- 靶场
   MUSIC_EFFECT_CITY_HORSE = "2012.mp3",             -- 马厩
   MUSIC_EFFECT_CITY_SIGIE = "2013.mp3",             -- 攻城武器
   MUSIC_EFFECT_CITY_BLACKSMIT = "2014.mp3",         -- 铁匠铺
   MUSIC_EFFECT_CITY_ABBEY = "2015.mp3",             -- 修道院
   MUSIC_EFFECT_CITY_CASTLE = "2016.mp3",            -- 城堡
   MUSIC_EFFECT_CITY_COLLEGE = "2017.mp3",           -- 大学
   MUSIC_EFFECT_CITY_FOOD = "2018.mp3",              -- 磨坊
   MUSIC_EFFECT_CITY_LUMBER = "2019.mp3",            -- 伐木场
   MUSIC_EFFECT_CITY_STONE = "2020.mp3",             -- 采矿场
   MUSIC_EFFECT_CITY_MARKET = "2021.mp3",            -- 市场
   MUSIC_EFFECT_CITY_WONDER = "2022.mp3",            -- 奇迹
   MUSIC_EFFECT_CITY_REST = "2023.mp3",              -- 其它建筑物

   MUSIC_EFFECT_CITY_BUILD_UPGRADE = "2024.mp3",     -- 升级建筑
   MUSIC_EFFECT_CITY_BUILF_TRAIN = "2025.mp3",       -- 训练建筑
   MUSIC_EFFECT_CITY_BUILD_STUDY = "2025.mp3",               -- 研究建筑  重复

   MUSIC_EFFECT_CITY_NEWMAIL ="2027.mp3",            -- 新邮件
   MUSIC_EFFECT_CITY_WORKER = "2028.mp3",            -- 新工人
   MUSIC_EFFECT_CITY_INFANTRY = "2029.mp3",          -- 新步兵
   MUSIC_EFFECT_CITY_SAPPER = "2030.mp3",            -- 新弓兵
   MUSIC_EFFECT_CITY_SOWAR = "2031.mp3",             -- 骑兵
   MUSIC_EFFECT_CITY_V_SOLDIER = "2032.mp3",         -- 车兵

   MUSIC_EFFECT_CITY_END_UPGRADE = "2033.mp3",       -- 建筑物升级完成
   MUSIC_EFFECT_CITY_END_STUDY ="2035.mp3",          -- 建筑物研究完成

   MUSIC_EFFECT_WORKER_YES = "2036.mp3",             -- 工人说YES
   
   MUSIC_EFFECT_WOOD_HARVEST = "4001.mp3",           -- 收获木材

   MUSIC_EFFECT_FOOD_HARVEST = "4002.mp3",           -- 收获粮食

   MUSIC_EFFECT_STONE_HAVREST = "4003.mp3",          -- 收获石头

   MUSIC_EFFECT_GOLD_HAVREST = "4004.mp3",           -- 收获金币
}
-- 记录播放音效的ID
MUSIC_EFFECT_ID = {

   MUSIC_EFFECT_N_EUROPE = 0,               -- 北欧入场
   MUSIC_EFFECT_W_EUROPE = 0,               -- 西欧入场
   MUSIC_EFFECT_ARAB = 0,                   -- 阿拉伯入场
   MUSIC_EFFECT_ASIAN = 0,                  -- 亚洲入场
   MUSIC_EFFECT_AMERICA = 0,                -- 美洲入场

   MUSIC_EFFECT_BUTTON = 0,                 -- 按钮音效
   MUSIC_EFFECT_CITY_CENTER = 0,            -- 城镇中心
   MUSIC_EFFECT_CITY_HOUSE = 0,             -- 房屋
   MUSIC_EFFECT_CITY_DOOR = 0,              -- 城门
   MUSIC_EFFECT_CITY_TOWER = 0,             -- 瞭望塔
   MUSIC_EFFECT_CITY_BARRACK = 0,           -- 军营
   MUSIC_EFFECT_CITY_RANGE = 0,             -- 靶场
   MUSIC_EFFECT_CITY_HORSE = 0,             -- 马厩
   MUSIC_EFFECT_CITY_SIGIE = 0,             -- 攻城武器
   MUSIC_EFFECT_CITY_BLACKSMIT = 0,         -- 铁匠铺
   MUSIC_EFFECT_CITY_ABBEY = 0,             -- 修道院
   MUSIC_EFFECT_CITY_CASTLE = 0,            -- 城堡
   MUSIC_EFFECT_CITY_COLLEGE = 0,           -- 大学
   MUSIC_EFFECT_CITY_FOOD = 0,              -- 磨坊
   MUSIC_EFFECT_CITY_LUMBER = 0,            -- 伐木场
   MUSIC_EFFECT_CITY_STONE = 0,             -- 采矿场
   MUSIC_EFFECT_CITY_MARKET = 0,            -- 市场
   MUSIC_EFFECT_CITY_WONDER =0,            -- 奇迹
    MUSIC_EFFECT_CITY_REST = 0,              -- 其它建筑物

   MUSIC_EFFECT_CITY_BUILD_UPGRADE = 0,     -- 升级建筑
   MUSIC_EFFECT_CITY_BUILF_TRAIN = 0,       -- 训练建筑
   MUSIC_EFFECT_CITY_BUILD_STUDY = 0,               -- 研究建筑  重复

   MUSIC_EFFECT_CITY_NEWMAIL =0,            -- 新邮件
   MUSIC_EFFECT_CITY_WORKER = 0,            -- 新工人
   MUSIC_EFFECT_CITY_INFANTRY = 0,          -- 新步兵
   MUSIC_EFFECT_CITY_SAPPER = 0,            -- 新弓兵
   MUSIC_EFFECT_CITY_SOWAR = 0,             -- 骑兵
   MUSIC_EFFECT_CITY_V_SOLDIER = 0,         -- 车兵

   MUSIC_EFFECT_CITY_END_UPGRADE = 0,       -- 建筑物升级完成
   MUSIC_EFFECT_CITY_END_STUDY =0,          -- 建筑物研究完成

   MUSIC_EFFECT_WORKER_YES = 0,             -- 工人说YES

   MUSIC_EFFECT_WOOD_HARVEST = 0,           -- 收获木材

   MUSIC_EFFECT_FOOD_HARVEST = 0,           -- 收获粮食

   MUSIC_EFFECT_STONE_HAVREST = 0,          -- 收获石头

   MUSIC_EFFECT_GOLD_HAVREST = 0,           -- 收获金币
}



AudioMusic = class("AudioMusic")
AudioMusic.__index = AudioMusic
function AudioMusic:create()
    return AudioMusic.new()
     
end

AudioMusic.MUSICOFF = true -- 开启背景音乐
AudioMusic.MUSICEFFECT = true -- 开启音效
function AudioMusic:ctor()  
    self.BackMusicStr = ""
    self.updateTimer = nil
    self.OldName = nil
    AudioMusic.MUSICOFF = SharedDataStorageHelper():getUserMic()
    AudioMusic.MUSICEFFECT = SharedDataStorageHelper():getUserEffect()
end
function AudioMusic:init()   
    return true
end
-- 播放背景音乐
function AudioMusic:setBackMusic(pName)
     self.BackMusicStr = pName
   if AudioMusic.MUSICOFF then       
        AudioEngine.playMusic(pName, true) -- 播放音乐     
        AudioEngine.setMusicVolume(0.1)    
   end
   
end
-- 暂停背景音乐
function AudioMusic:PuseBackMusic()
    AudioEngine.pauseMusic()
end
-- 恢复播放背景音乐
function AudioMusic:resumeBackMusic()
    AudioEngine.resumeMusic()
end
-- true 结束播放，false停止播放，true如果在播放中先停止播放
function AudioMusic:stopBackMusic(pBool)
      AudioEngine.stopMusic(pBool)
end
-- 播放音效 true 循环播放
function AudioMusic:setPlayEffect(pName,isLoop,pRepeat)
  if AudioMusic.MUSICEFFECT then
   
    local loopValue = false
    if nil ~= isLoop then
        loopValue = isLoop
    end
    if pRepeat~=nil then
        if self.OldName~= nil then
          if self.OldName == pName then      
            return
         end
       end
        self.OldName = pName
        self:pPlayTime() 
    end
   
    local pId =  AudioEngine.playEffect(pName, loopValue) -- 播放音乐 
       
 
    for key, var in pairs(MUSIC_TYPE) do
        if var == pName then
          MUSIC_EFFECT_ID[key] = pId
          break
        end
     end   
   end

   -- dump(MUSIC_EFFECT_ID)
end
-- 停止音效
function AudioMusic:stopPalyEffect(pName)
    local pId = self:getEffectId(pName)
    if pId ~= 0  then
       AudioEngine.stopEffect(pId)    
    end
end
-- 暂停音效
function AudioMusic:pausePalyEffect(pName)
    local pId = self:getEffectId(pName)
    if pId ~= 0  then
       AudioEngine.pauseEffect(pId)    
    end
end
-- 恢复音效
function AudioMusic:resumePalyEffect(pName)
    local pId = self:getEffectId(pName)
    if pId ~= 0  then
       AudioEngine.resumeEffect(pId)    
    end
end
-- 获取音效的ID 用于暂停等
function AudioMusic:getEffectId(pName)
     local pId = 0
      local pIdName = nil
      for key, var in pairs(MUSIC_TYPE) do
        if var == pName then
          pIdName = key
          break
        end
    end   
    if pIdName ~= nil then
       pId = MUSIC_EFFECT_ID[pIdName]      
    end     
    return pId 
end
-- 背景音乐
function AudioMusic:musicButton()
    AudioMusic.MUSICOFF = not AudioMusic.MUSICOFF
    SharedDataStorageHelper():setUserMic(AudioMusic.MUSICOFF)
     if AudioMusic.MUSICOFF then    -- 开启声音
        self:openAllMusic()
       else
       self:stopAllMusic()
     end
end

-- 背景音效
function AudioMusic:effectButton()
    AudioMusic.MUSICEFFECT = not AudioMusic.MUSICEFFECT
    SharedDataStorageHelper():setUserEffect(AudioMusic.MUSICEFFECT)
     if AudioMusic.MUSICEFFECT then    -- 开启音效
        self:openAllEffect()
       else
       self:stopAllEffect()
     end
end

 
-- 设置界面 关闭声音
function AudioMusic:stopAllMusic()
     if AudioMusic.MUSICOFF == false then             
         self:stopBackMusic(true)       -- 暂停背景音乐         
     end  
end
-- 设置界面 开启声音
function AudioMusic:openAllMusic()
  if AudioMusic.MUSICOFF == true then
      self:setBackMusic(self.BackMusicStr)         -- 开启背景音乐      
  end
end

-- 设置界面 关闭音效
function AudioMusic:stopAllEffect()
     if AudioMusic.MUSICEFFECT == false then
         AudioEngine.stopAllEffects()       -- 停止音效               
     end  
end
-- 设置界面 开启音效
function AudioMusic:openAllEffect()
  if AudioMusic.MUSICEFFECT~= true then
       
  end
end
function AudioMusic:pPlayTime()   --播放倒计时
       if self.updateTimer ~= nil then
          me.clearTimer(self.updateTimer)  
           self.updateTimer = nil        
       end
       self.updateTimer = me.registTimer(1,function (args)
             self.OldName = nil
             me.clearTimer(self.updateTimer)  
             self.updateTimer = nil
       end, 2)
end
function AudioMusic:onEnter()   
	--me.doLayout(self,me.winSize)  
end
function AudioMusic:onExit()
      me.clearTimer(self.updateTimer)  
end
